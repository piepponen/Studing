# META-Back-End-Little-Lemon-API

## Description of the project

This is the final project for APIs course (Meta Back-End Developer Professional Certificate) to build an API for the Little Lemon restaurant.

Little Lemon's management wants to develop an online-based order management system and mobile application. They need the back-end API that allows customers to browse food items, view the item of the day and place orders. Managers need to be able to update the item of the day and monitor orders and assign deliveries. And the delivery crew should be able to check the orders assigned to them and update an order once it’s delivered.

---

## API URL

Localhost base URL is http://127.0.0.1:8000

---

## Getting Started

### Installation and Database Setup

Clone the repo by running

```bash
git clone 
```

#### Installing Dependencies

- [Python 3.11.0](https://docs.python.org/3/using/unix.html#getting-and-installing-the-latest-version-of-python).
- [Pipenv](https://pipenv.pypa.io/en/latest/) creates and manages a virtualenv for your projects, as well as adds/removes packages from your Pipfile as you install/uninstall packages. It also generates the ever-important Pipfile.lock, which is used to produce deterministic builds.

#### Virtual Environment

It is recommended to work within a virtual environment whenever using Python for projects. This keeps your dependencies for each project separate and organized. Instructions for setting up a virtual environment for your platform can be found in the [pipenv docs](https://pipenv.pypa.io/en/latest/).

Navigate to the project directory

```bash
cd LittleLemon
```

Activate the virtual environment:

```bash
pipenv shell
```

Install the virtual environment dependencies:

```bash
pipenv install
```

## Database Setup

The project uses **SQLite** database.

Generate database tables from the models:

```bash
python3 manage.py makemigrations
```

```bash
python3 manage.py migrate
```

## Running the Server

Switch to the project directory and ensure that the virtual environment is running.

```bash
python3 manage.py runserver
```

---

## Testing

In `notes.txt` you can find credentials for admin, manager, delivery_crew and user.

One Insomnia collection is included for testing.

`LittleLemonAPI_test.json`

To use them install [Insomnia](https://insomnia.rest/) locally and import the collection. In order for them to work properly, update the Bearer Tokens in each collection with tokens generated from the website. See the `notes.txt`.

---

## API

In order to use the API, users need to be authenticated. JWT tokens can be generated by logging in with the provided credentials (username and password) on the hosted site.

POST http://127.0.0.1:8000/auth/token/login/

### Endpoints

- Note: any `curl` commands used must include an authorization header as all endpoints require authorization to use:  
  `curl -H "Authorization: Bearer <JWT_ACCESS_TOKEN>"`
- For post and patch you need you need also add Content-Type:
  `curl -H "Authorization: Bearer <JWT_ACCESS_TOKEN>" -H "Content-Type: application/json" -d "{data}"`

#### User registration and token generation endpoints

| Endpoint           | Role                                      | Method | Purpose                                                                     |
| ------------------ | ----------------------------------------- | ------ | --------------------------------------------------------------------------- |
| /auth/users        | No role required                          | POST   | Creates a new user with name, email and password                            |
| /auth/users/me/    | Anyone with a valid user token            | GET    | Displays only the current user                                              |
| auth//token/login/ | Anyone with a valid username and password | POST   | Generates access tokens that can be used in other API calls in this project |

#### Menu-items endpoints

- Fetches a dictionary of dictionaries for each menu-items from the database.
- Request Arguments for POST and UPDATE: title, price, featured, category_id.
- Request Arguments for PATCH: None (it automatically updates featured (true or false)).
- Request Arguments for GET and DELETE: None.

| Endpoint                   | Role                    | Method                   | Purpose                                                       |
| -------------------------- | ----------------------- | ------------------------ | ------------------------------------------------------------- |
| /api/menu-items            | Customer, delivery crew | GET                      | Lists all menu items. Return a 200 – Ok HTTP status code      |
| /api/menu-items            | Customer, delivery crew | POST, PUT, PATCH, DELETE | Denies access and returns 403 – Unauthorized HTTP status code |
| /api/menu-items/{menuItem} | Customer, delivery crew | GET                      | Lists single menu item                                        |
| /api/menu-items/{menuItem} | Customer, delivery crew | POST, PUT, PATCH, DELETE | Returns 403 - Unauthorized                                    |
| /api/menu-items            | Manager                 | GET                      | Lists all menu items. Return a 200 – Ok HTTP status code      |
| /api/menu-items            | Manager                 | POST                     | Creates a new menu item and returns 201 - Created             |
| /api/menu-items/{menuItem} | Manager                 | GET                      | Lists single menu item                                        |
| /api/menu-items/{menuItem} | Manager                 | PUT, PATCH               | Updates single menu item                                      |
| /api/menu-items/{menuItem} | Manager                 | DELETE                   | Deletes menu item                                             |

#### User group management endpoints

- Fetches a dictionary of dictionaries for each user (manager or delivery crew) from the database.
- Request Arguments for POST: username.
- Request Arguments for GET and DELETE: None.

| Endpoint                                 | Role    | Method | Purpose                                                                                                                                                |
| ---------------------------------------- | ------- | ------ | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| /api/groups/manager/users                | Admin   | GET    | Returns all managers                                                                                                                                   |
| /api/groups/manager/users                | Admin   | POST   | Assigns the user in the payload to the manager group and returns 201-Created                                                                           |
| /api/groups/manager/users/{userId}       | Admin   | DELETE | Removes this particular user from the manager group and returns 200 – Success if everything is okay. If the user is not found, returns 404 – Not found |
| /api/groups/delivery-crew/users          | Manager | GET    | Returns all delivery crew                                                                                                                              |
| /api/groups/delivery-crew/users          | Manager | POST   | Assigns the user in the payload to delivery crew group and returns 201-Created HTTP code                                                               |
| /api/groups/delivery-crew/users/{userId} | Manager | DELETE | Removes this user from the manager group and returns 200 – Success if everything is okay. If the user is not found, returns 404 – Not found item       |

#### Cart management endpoints

- Fetches a dictionary of dictionaries for each cart/menu-items from the database.
- Request Arguments for POST, PATCH, UPDATE: menuitem_id, quantity.
- Request Arguments for GET and DELETE: None.

| Endpoint                           | Role     | Method     | Purpose                                                                                         |
| ---------------------------------- | -------- | ---------- | ----------------------------------------------------------------------------------------------- |
| /api/cart/menu-items               | Customer | GET        | Returns current items in the cart for the current user token                                    |
| /api/cart/menu-items               | Customer | POST       | Adds the menu item to the cart. Sets the authenticated user as the user id for these cart items |
| /api/cart/menu-items               | Customer | DELETE     | Deletes all menu items created by the current user token                                        |
| /api/cart/menu-items/{menuitem_id} | Customer | GET        | Returns current menu item in the cart for the current user                                      |
| /api/cart/menu-items/{menuitem_id} | Customer | PATCH, PUT | Update current menu item in the cart for the current user                                       |
| /api/cart/menu-items/{menuitem_id} | Customer | DELETE     | Deletes current menu item created by the current user                                           |

#### Order management endpoints

- Fetches a dictionary of dictionaries for each order from the database.
- Request Arguments for PUT: quantity, delivery_crew.
- Request Arguments for PATCH: None (it automatically updates status (true or false)).
- Request Arguments for GET, POST and DELETE: None.

| Endpoint              | Role          | Method     | Purpose                                                                                                                                                                                                                                                                                                                                               |
| --------------------- | ------------- | ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| /api/orders           | Customer      | GET        | Returns all orders with order items created by this user                                                                                                                                                                                                                                                                                              |
| /api/orders           | Customer      | POST       | Creates a new order item for the current user. Gets current cart items from the cart endpoints and adds those items to the order items table. Then deletes all items from the cart for this user.                                                                                                                                                     |
| /api/orders/{orderId} | Customer      | GET        | Returns all items for this order id. If the order ID doesn’t belong to the current user, it displays an appropriate HTTP error status code.                                                                                                                                                                                                           |
| /api/orders           | Manager       | GET        | Returns all orders with order items by all users                                                                                                                                                                                                                                                                                                      |
| /api/orders/{orderId} | Manager       | PUT, PATCH | Updates the order. A manager can use this endpoint to set a delivery crew to this order, and also update the order status to 0 or 1. If a delivery crew is assigned to this order and the status = 0, it means the order is out for delivery. If a delivery crew is assigned to this order and the status = 1, it means the order has been delivered. |
| /api/orders/{orderId} | Manager       | DELETE     | Deletes this order                                                                                                                                                                                                                                                                                                                                    |
| /api/orders           | Delivery crew | GET        | Returns all orders with order items assigned to the delivery crew                                                                                                                                                                                                                                                                                     |
| /api/orders/{orderId} | Manager       | PATCH      | A delivery crew can use this endpoint to update the order status to 0 or 1. The delivery crew will not be able to update anything else in this order.                                                                                                                                                                                                 |
